{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://alpa-construction.com/schemas/PortfolioCard.json",
  "title": "PortfolioCard",
  "description": "Aggregated portfolio metrics for dashboard display",
  "type": "object",
  "required": [
    "org_id",
    "metric_type",
    "value",
    "unit",
    "as_of",
    "calc_version"
  ],
  "properties": {
    "org_id": {
      "type": "string",
      "format": "uuid",
      "description": "Organization ID (for RLS isolation)"
    },
    "metric_type": {
      "type": "string",
      "enum": ["budget", "schedule", "safety", "quality"],
      "description": "Type of portfolio metric"
    },
    "value": {
      "type": "number",
      "description": "Aggregated metric value"
    },
    "unit": {
      "type": "string",
      "enum": ["percentage", "currency", "count", "days"],
      "description": "Unit of measurement"
    },
    "trend": {
      "type": "object",
      "description": "Trend analysis (vs previous period)",
      "properties": {
        "direction": {
          "type": "string",
          "enum": ["up", "down", "flat"]
        },
        "change": {
          "type": "number",
          "description": "Absolute change from previous period"
        },
        "change_percentage": {
          "type": "number",
          "description": "Percentage change from previous period"
        },
        "previous_value": {
          "type": "number"
        },
        "previous_as_of": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "breakdown": {
      "type": "object",
      "description": "Breakdown by project status or type",
      "properties": {
        "by_status": {
          "type": "object",
          "additionalProperties": {
            "type": "number"
          }
        },
        "by_type": {
          "type": "object",
          "additionalProperties": {
            "type": "number"
          }
        }
      }
    },
    "projects_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of projects included in aggregation"
    },
    "as_of": {
      "type": "string",
      "format": "date-time",
      "description": "Calculation timestamp (ISO 8601, UTC)"
    },
    "calc_version": {
      "type": "string",
      "pattern": "^v\\d+\\.\\d+$",
      "description": "Calculation version (e.g., v1.0)"
    },
    "trace_id": {
      "type": "string",
      "format": "uuid",
      "description": "Trace ID for debugging"
    },
    "calculation_duration_ms": {
      "type": "integer",
      "minimum": 0,
      "description": "Time taken to calculate metric (milliseconds)"
    }
  },
  "additionalProperties": false
}